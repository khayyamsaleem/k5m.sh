{{ define "title" }}{{ .Site.Title }}{{ end }}

{{ define "main" }}
<p>{{ .Content }}</p>
<table id="posts" style="width:100%">
  <thead>
    <tr>
      <th>Title</th>
      <th data-sort-key="created" style="cursor:pointer;">Created ▲▼</th>
      <th data-sort-key="modified" style="cursor:pointer;">Modified ▲▼</th>
    </tr>
  </thead>

  <tbody>
    {{/*  default build order = newest first  */}}
    {{ range .Site.RegularPages }}
      <tr data-created="{{ .Date.Unix }}" data-modified="{{ .Lastmod.Unix }}">
        <td><a href="{{ .RelPermalink }}">
          {{- with .Title -}}
            {{ . | $.RenderString }}
          {{- else -}}
            {{ humanize .File.TranslationBaseName | lower | $.RenderString}}
          {{- end -}}
        </a></td>
        <td>{{ with .Date }}{{ .Format "02 Jan 2006" }}{{ else }}{{ .Lastmod.Format "02 Jan 2006" }}{{ end }}</td>
        <td>{{ .Lastmod.Format "02 Jan 2006" }}</td>
      </tr>
    {{ end }}
  </tbody>
</table>

<script>
(() => {
  const table = document.getElementById('posts');
  let currentKey = null, asc = false;   // track sort state

  function sortRows(key) {
    const rows = Array.from(table.tBodies[0].rows);
    rows.sort((a, b) => {
      const av = +a.dataset[key];
      const bv = +b.dataset[key];
      return asc ? av - bv : bv - av;
    });
    rows.forEach(r => table.tBodies[0].appendChild(r));
  }

  table.tHead.addEventListener('click', e => {
    const th = e.target.closest('th[data-sort-key]');
    if (!th) return;
    const key = th.dataset.sortKey;
    asc = currentKey === key ? !asc : false;  // toggle on repeat click
    currentKey = key;
    sortRows(key);
  });
})();
</script>
{{ end }}
